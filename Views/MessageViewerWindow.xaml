<Window x:Class="PmLiteMonitor.Views.MessageViewerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Message Viewer" Height="750" Width="1100"
        Background="#1E1E1E" Foreground="White"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <Style x:Key="HeaderLabel" TargetType="TextBlock">
            <Setter Property="FontSize"   Value="10"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="Margin"     Value="0,0,0,2"/>
        </Style>
        <Style x:Key="InfoValue" TargetType="TextBlock">
            <Setter Property="FontSize"   Value="12"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style x:Key="ToolBtn" TargetType="Button"
               BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding"    Value="14,6"/>
            <Setter Property="Margin"     Value="0,0,6,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- toolbar -->
            <RowDefinition Height="Auto"/>   <!-- file info bar -->
            <RowDefinition Height="Auto"/>   <!-- filter bar -->
            <RowDefinition Height="*"/>      <!-- main content -->
            <RowDefinition Height="Auto"/>   <!-- stats bar -->
        </Grid.RowDefinitions>

        <!-- ── Toolbar ──────────────────────────────────────────────────── -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Open File"
                    Command="{Binding OpenFileCommand}"
                    Style="{StaticResource ToolBtn}"
                    Background="#0D47A1"/>
            <Button Content="Export CSV"
                    Command="{Binding ExportCsvCommand}"
                    Style="{StaticResource ToolBtn}"
                    Background="#1B5E20"/>
            <Button Content="Clear Filter"
                    Command="{Binding ClearFilterCommand}"
                    Style="{StaticResource ToolBtn}"
                    Background="#4A4A4A"/>
        </StackPanel>

        <!-- ── File info bar ────────────────────────────────────────────── -->
        <Border Grid.Row="1" Background="#252525" CornerRadius="4"
                Padding="12,8" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,20,0">
                    <TextBlock Text="File" Style="{StaticResource HeaderLabel}"/>
                    <TextBlock Text="{Binding FilePath}"
                               Style="{StaticResource InfoValue}"
                               TextTrimming="CharacterEllipsis"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Margin="0,0,20,0">
                    <TextBlock Text="Format" Style="{StaticResource HeaderLabel}"/>
                    <TextBlock Text="{Binding FileType}" Style="{StaticResource InfoValue}"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Margin="0,0,20,0">
                    <TextBlock Text="Capture Time" Style="{StaticResource HeaderLabel}"/>
                    <TextBlock Text="{Binding CaptureTime}" Style="{StaticResource InfoValue}"/>
                </StackPanel>
                <StackPanel Grid.Column="3">
                    <TextBlock Text="Total Frames" Style="{StaticResource HeaderLabel}"/>
                    <TextBlock Text="{Binding EntryCount}" Style="{StaticResource InfoValue}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ── Filter bar ───────────────────────────────────────────────── -->
        <Grid Grid.Row="2" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="160"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0"
                     Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                     Foreground="White" CaretBrush="White"
                     md:HintAssist.Hint="Search timestamp, type, summary, hex…"
                     md:HintAssist.Foreground="#888888"
                     Height="32" Margin="0,0,8,0"/>

            <ComboBox Grid.Column="1"
                      ItemsSource="{Binding TypeFilters}"
                      SelectedValue="{Binding SelectedTypeFilter}"
                      Foreground="White" Background="#2A2A2A" Height="32"
                      md:ComboBoxAssist.ShowSelectedItem="True"/>
        </Grid>

        <!-- ── Main content: grid (top) + detail (bottom) ───────────────── -->
        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="3*"/>   <!-- message grid -->
                <RowDefinition Height="4"/>    <!-- splitter -->
                <RowDefinition Height="*"/>    <!-- detail panel -->
            </Grid.RowDefinitions>

            <!-- Message grid -->
            <DataGrid Grid.Row="0"
                      ItemsSource="{Binding Rows}"
                      SelectedItem="{Binding SelectedRow}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserSortColumns="True"
                      CanUserResizeColumns="True"
                      SelectionMode="Single"
                      Background="#1E1E1E"
                      RowBackground="#252525"
                      AlternatingRowBackground="#2A2A2A"
                      Foreground="White"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="#3A3A3A"
                      BorderBrush="#3A3A3A"
                      FontFamily="Consolas" FontSize="11">

                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background"  Value="#2D2D2D"/>
                        <Setter Property="Foreground"  Value="#AAAAAA"/>
                        <Setter Property="FontSize"    Value="11"/>
                        <Setter Property="FontWeight"  Value="SemiBold"/>
                        <Setter Property="Padding"     Value="6,4"/>
                        <Setter Property="BorderBrush" Value="#444"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Timestamp"
                                        Binding="{Binding Timestamp}"
                                        Width="100"/>
                    <DataGridTextColumn Header="Type"
                                        Binding="{Binding TypeLabel}"
                                        Width="90"/>
                    <DataGridTextColumn Header="Size"
                                        Binding="{Binding Size}"
                                        Width="50"/>
                    <DataGridTextColumn Header="Summary"
                                        Binding="{Binding Summary}"
                                        Width="*"/>
                    <DataGridTextColumn Header="Hex Dump"
                                        Binding="{Binding HexDump}"
                                        Width="260"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Height="4" HorizontalAlignment="Stretch"
                          Background="#3A3A3A" ResizeDirection="Rows"/>

            <!-- Detail panel -->
            <Border Grid.Row="2" Background="#141414" CornerRadius="4"
                    Margin="0,4,0,0" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="Message Detail"
                               FontSize="10" Foreground="#AAAAAA" Margin="0,0,0,4"/>
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <TextBlock Text="{Binding DetailText}"
                                   FontFamily="Consolas" FontSize="11"
                                   Foreground="#E0E0E0" TextWrapping="Wrap"/>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- ── Status / stats bar ────────────────────────────────────────── -->
        <Border Grid.Row="4" Background="#252525" CornerRadius="3"
                Padding="10,5" Margin="0,6,0,0">
            <Grid>
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="#AAAAAA" FontSize="10"
                           HorizontalAlignment="Left"/>
                <TextBlock Text="{Binding StatsText}"
                           Foreground="#90CAF9" FontSize="10"
                           HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</Window>
